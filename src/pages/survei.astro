---
import MainLayout from '../layouts/MainLayout.astro';
import { getEntry } from 'astro:content';
import Banner from '../components/sections/Banner.astro';
import Section from '../components/ui/Section.astro';
import Card from '../components/ui/Card.astro';

const teamsDataEntry = await getEntry('surveys', 'teams');
const scheduleDataEntry = await getEntry('surveys', 'schedule');
const guidelinesDataEntry = await getEntry('surveys', 'guidelines');

if (!teamsDataEntry || !('teams' in teamsDataEntry.data)) {
  throw new Error('Teams survey data not found');
}

if (!scheduleDataEntry || !('schedule' in scheduleDataEntry.data)) {
  throw new Error('Schedule survey data not found');
}

if (!guidelinesDataEntry || !('guidelines' in guidelinesDataEntry.data)) {
  throw new Error('Guidelines survey data not found');
}

const teamsData = teamsDataEntry.data;
const scheduleData = scheduleDataEntry.data;
const guidelinesData = guidelinesDataEntry.data;

const { title, description, databaseUrl, teams, colorClasses } = teamsData;
const { schedule } = scheduleData;
const { guidelines } = guidelinesData;
---

<MainLayout
  title={title}
  description={description}
>
  <Banner
    title={title}
    subtitle={description}
    background="gradient"
  />

  <!-- Hero Section -->
  <Section background="white">
    <div class="mx-auto max-w-3xl text-center">
      <div class="mb-8 flex justify-center">
        <i class="fas fa-clipboard-list text-6xl text-blue-600"></i>
      </div>
      <h2 class="mb-4 text-3xl font-bold text-gray-800">Program Survei Digitalisasi</h2>
      <p class="mb-8 text-lg leading-relaxed text-gray-600">
        Halaman ini berisi panduan survei dan link formulir untuk tim KKN dalam rangka 
        pendataan potensi desa dan digitalisasi informasi Dusun Bedalo.
      </p>
      
      <!-- Database Link -->
      <a
        href={databaseUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 rounded-lg bg-green-600 px-8 py-4 text-lg font-bold text-white shadow-xl transition-all hover:scale-105 hover:bg-green-700"
      >
        <i class="fas fa-file-excel text-xl"></i>
        Buka Database Hasil Survei
      </a>
    </div>
  </Section>

  <!-- Teams & Forms -->
  <Section background="gray">
    <div class="mb-12 text-center">
      <h2 class="mb-2 text-3xl font-bold text-gray-800">
        <i class="fas fa-users mr-2 text-blue-600"></i>
        Tugas Tim & Tautan Formulir
      </h2>
      <p class="text-gray-600">Setiap tim memiliki tugas dan formulir spesifik</p>
    </div>

    <div class="space-y-8">
      {
        teams.map((team) => (
          <Card variant="default" padding="p-6">
            <h3
              class:list={[
                'mb-4 border-b pb-2 text-xl font-bold',
                colorClasses[team.color]
              ]}
            >
              {team.name}
            </h3>
            <p class="mb-6 text-gray-600">{team.description}</p>
            
            <div class:list={[
              'grid gap-4',
              team.forms.length === 2 ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4'
            ]}>
              {team.forms.map((form) => (
                <a
                  href={form.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class:list={[
                    'rounded-md px-4 py-3 text-center font-semibold text-white transition-colors',
                    colorClasses[form.color]
                  ]}
                >
                  <i class="fas fa-external-link-alt mr-2" />
                  {form.title}
                </a>
              ))}
            </div>
          </Card>
        ))
      }
    </div>
  </Section>

  <!-- Schedule Section -->
  <Section background="white">
    <div class="mx-auto max-w-4xl">
      <div class="mb-8 text-center">
        <h2 class="mb-2 text-3xl font-bold text-gray-800">
          <i class="fas fa-calendar-alt mr-2 text-purple-600"></i>
          Jadwal Survei
        </h2>
        <p class="text-gray-600">Rencana pelaksanaan survei lapangan</p>
      </div>

      <div class="grid gap-8 md:grid-cols-2">
        {schedule.map((day) => (
          <Card variant="default" padding="p-6">
            <h3 class:list={['mb-4 text-xl font-bold', `text-${day.color}-700`]}>
              <i class="far fa-calendar mr-2"></i>
              {day.title}
            </h3>
            <div class="space-y-4">
              {day.sessions.map((session) => (
                <div class="rounded-lg bg-gray-50 p-4">
                  <p class="font-bold text-gray-700">{session.time}: {session.title}</p>
                  <p class="text-sm text-gray-600">{session.description}</p>
                </div>
              ))}
            </div>
          </Card>
        ))}
      </div>
    </div>
  </Section>

  <!-- Guidelines -->
  <Section background="gray">
    <div class="mx-auto max-w-3xl">
      <Card variant="default" padding="p-8">
        <h3 class="mb-6 text-2xl font-bold text-gray-800">
          <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
          Panduan Umum
        </h3>
        
        <div class="space-y-4">
          {guidelines.map((guideline) => (
            <div class="flex gap-4">
              <div class="flex-shrink-0">
                <i class:list={[guideline.icon, 'text-2xl', `text-${guideline.iconColor}`]}></i>
              </div>
              <div>
                <h4 class="mb-1 font-bold text-gray-800">{guideline.title}</h4>
                <p class="text-gray-600">{guideline.description}</p>
              </div>
            </div>
          ))}
        </div>
      </Card>
    </div>
  </Section>

  <!-- Contact CTA -->
  <Section background="white">
    <div class="mx-auto max-w-2xl text-center">
      <div class="rounded-xl bg-gradient-to-r from-blue-600 to-purple-700 p-8 text-white shadow-xl">
        <i class="fas fa-question-circle mb-4 text-5xl"></i>
        <h2 class="mb-4 text-2xl font-bold">Ada Pertanyaan?</h2>
        <p class="mb-6 text-blue-100">
          Hubungi koordinator Tim 1 atau tim KKN jika ada pertanyaan terkait survei.
        </p>
        <a
          href="/kontak"
          class="inline-block rounded-lg bg-white px-6 py-3 font-semibold text-blue-600 transition-colors hover:bg-blue-50"
        >
          <i class="fas fa-envelope mr-2"></i>
          Hubungi Kami
        </a>
      </div>
    </div>
  </Section>
</MainLayout>
