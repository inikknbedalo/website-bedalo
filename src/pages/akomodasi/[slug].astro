---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection, render, type CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Section from '../../components/ui/Section.astro';
import Card from '../../components/ui/Card.astro';

export async function getStaticPaths() {
  const allAccommodation = await getCollection('akomodasi');
  
  return allAccommodation.map((accommodation) => ({
    params: { slug: accommodation.id.replace(/\.md$/, '') },
    props: { accommodation },
  }));
}

interface Props {
  accommodation: CollectionEntry<'akomodasi'>;
}

const { accommodation } = Astro.props;
const { data } = accommodation;
const { Content } = await render(accommodation);

const waNumber = data.contact?.replace(/\D/g, '') || '';
const waLink = waNumber ? `https://wa.me/${waNumber}?text=Halo, saya tertarik dengan ${data.title}` : '#';
---

<MainLayout title={data.title} description={data.description}>

  <!-- Main Content -->
  <Section background="white">
    <div class="mx-auto grid max-w-6xl gap-8 lg:grid-cols-3">
      <!-- Left: Image & Quick Info -->
      <div class="lg:col-span-1">
        <!-- Image -->
        <div class="sticky top-24">
          <Image
            src={data.image}
            alt={data.imageAlt}
            class="mb-6 aspect-[4/3] w-full rounded-lg object-cover shadow-xl"
            widths={[400, 600]}
            sizes="(max-width: 1024px) 100vw, 33vw"
          />

          <!-- Quick Info Card -->
          <Card variant="default" padding="p-6">
            <h3 class="mb-4 text-lg font-bold text-gray-800">Informasi Cepat</h3>

            <div class="space-y-3">
              <!-- Price -->
              <div class="flex items-center justify-between border-b border-gray-200 pb-3">
                <span class="text-sm text-gray-600">Harga</span>
                <span class="font-bold text-blue-600">{data.price}</span>
              </div>

              <!-- Capacity -->
              <div class="flex items-center justify-between border-b border-gray-200 pb-3">
                <span class="text-sm text-gray-600">Kapasitas</span>
                <span class="font-semibold text-gray-700">
                  <i class="fas fa-users mr-1 text-gray-400"></i>
                  {data.capacity} orang
                </span>
              </div>

              <!-- Type -->
              <div class="flex items-center justify-between border-b border-gray-200 pb-3">
                <span class="text-sm text-gray-600">Tipe</span>
                <span class="rounded-full bg-purple-100 px-3 py-1 text-sm font-semibold text-purple-700">
                  {data.type === 'homestay' ? 'Homestay' : 'Penginapan'}
                </span>
              </div>

              <!-- Address -->
              <div class="border-b border-gray-200 pb-3">
                <span class="mb-1 block text-sm text-gray-600">Alamat</span>
                <p class="text-sm font-medium text-gray-700">
                  <i class="fas fa-map-marker-alt mr-1 text-gray-400"></i>
                  {data.address}
                </p>
              </div>

              <!-- Contact Button -->
              <a
                href={waLink}
                target="_blank"
                rel="noopener noreferrer"
                class="mt-4 block w-full rounded-lg bg-green-600 px-4 py-3 text-center font-semibold text-white transition-colors hover:bg-green-700"
              >
                <i class="fab fa-whatsapp mr-2"></i>
                Hubungi via WhatsApp
              </a>
            </div>
          </Card>
        </div>
      </div>

      <!-- Right: Description & Details -->
      <div class="lg:col-span-2">
        <!-- Description -->
        <Card variant="default" padding="p-8" class="mb-6">
          <article class="prose prose-lg max-w-none">
            <Content />
          </article>
        </Card>

        <!-- Facilities -->
        <Card variant="default" padding="p-8">
          <h3 class="mb-4 text-xl font-bold text-gray-800">
            <i class="fas fa-check-circle mr-2 text-green-600"></i>
            Fasilitas
          </h3>
          <div class="grid grid-cols-2 gap-4 sm:grid-cols-3">
            {
              data.facilities && data.facilities.map((facility) => (
                <div class="flex items-center gap-2 text-gray-700">
                  <i class="fas fa-check text-green-600" />
                  <span>{facility}</span>
                </div>
              ))
            }
          </div>
        </Card>
      </div>
    </div>
  </Section>

  <!-- Back Button -->
  <Section background="gray">
    <div class="text-center">
      <a
        href="/akomodasi"
        class="inline-flex items-center gap-2 rounded-lg bg-white px-6 py-3 font-semibold text-gray-700 shadow-md transition-colors hover:bg-gray-50"
      >
        <i class="fas fa-arrow-left"></i>
        Kembali ke Daftar Akomodasi
      </a>
    </div>
  </Section>
</MainLayout>
