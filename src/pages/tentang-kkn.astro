---
import MainLayout from '../layouts/MainLayout.astro';
import { getEntry } from 'astro:content';
import { Image } from 'astro:assets';
import Banner from '../components/sections/Banner.astro';
import Section from '../components/ui/Section.astro';
import TeamMemberCard from '../components/ui/TeamMemberCard.astro';

const pageContent = await getEntry('pages', 'tentang-kkn');

if (!pageContent) {
  throw new Error('Tentang KKN page content not found');
}

const { hero, intro, team } = pageContent.data;
---

<MainLayout title={hero.title} description={hero.subtitle}>
  <Banner title={hero.title} subtitle={hero.subtitle} />

  <!-- Introduction Section -->
  {
    intro && (
      <Section background="white">
        <div class="mb-12 text-center">
          <h2 class="mb-2 text-3xl font-bold text-gray-800" data-aos="fade-up">
            {intro.title}
          </h2>
          <p
            class="mx-auto max-w-2xl text-gray-600"
            data-aos="fade-up"
            data-aos-delay="100"
          >
            {intro.subtitle}
          </p>
        </div>
        <div class="flex flex-col items-center gap-8 md:flex-row md:gap-12" data-aos="fade-up" data-aos-delay="200">
          {intro.image && (
            <div class="md:w-1/2">
              <Image
                src={intro.image}
                alt={intro.imageAlt || 'Tim KKN'}
                class="aspect-video overflow-hidden rounded-lg shadow-xl transition-all duration-300 hover:-translate-y-1 hover:scale-[1.07] hover:shadow-2xl"
                widths={[400, 800]}
                sizes="(max-width: 768px) 100vw, 50vw"
              />
            </div>
          )}
          <div class={intro.image ? 'md:w-1/2' : ''}>
            <div class="prose prose-lg max-w-none space-y-6 leading-relaxed text-gray-700">
              {intro.content.split('\n\n').map((paragraph) => (
                <p set:html={paragraph.replace(/"([^"]+)"/g, '<strong>"$1"</strong>')} />
              ))}
            </div>
          </div>
        </div>
      </Section>
    )
  }

  <!-- Team Members Section -->
  {
    team && team.members.length > 0 && (
      <Section background="gray" id="tim">
        <div class="mb-12 text-center">
          <h2 class="mb-2 text-3xl font-bold text-gray-800">{team.title}</h2>
        </div>
        <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5">
          {team.members.map((member, index) => (
            <TeamMemberCard
              name={member.name}
              major={member.major}
              photo={member.photo}
              photoAlt={member.photoAlt}
              instagram={member.instagram}
              delay={100 + index * 50}
            />
          ))}
        </div>
      </Section>
    )
  }
</MainLayout>
