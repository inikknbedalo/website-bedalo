---
import { getEntry } from 'astro:content';

interface Props {
  type?: 'Organization' | 'Article' | 'Product' | 'Place' | 'LocalBusiness';
  data?: Record<string, unknown>;
}

const { type = 'Organization', data = {} } = Astro.props;

// Load site config for organization data
const siteConfigEntry = await getEntry('config', 'site');

if (!siteConfigEntry || !('site' in siteConfigEntry.data)) {
  throw new Error('Site configuration not found');
}

const siteConfig = siteConfigEntry.data;
const orgData = siteConfig.seo?.organization;

let schema: Record<string, unknown> = {
  '@context': siteConfig.seo?.schemaContext || 'https://schema.org',
};

if (type === 'Organization') {
  schema = {
    ...schema,
    '@type': 'Organization',
    name: orgData?.name || 'Dusun Bedalo',
    url: orgData?.url || siteConfig.site.url,
    logo: orgData?.logo || `${siteConfig.site.url}/assets/images/logo.png`,
    description: siteConfig.site.description,
    address: {
      '@type': 'PostalAddress',
      addressLocality: 'Saptosari',
      addressRegion: 'Gunungkidul',
      addressCountry: 'ID',
    },
    ...data,
  };
} else if (type === 'Article') {
  schema = {
    ...schema,
    '@type': 'Article',
    headline: data.title as string,
    description: data.description as string,
    image: data.image as string,
    datePublished: data.datePublished as string,
    dateModified: data.dateModified as string,
    author: {
      '@type': 'Person',
      name: data.author as string,
    },
    publisher: {
      '@type': 'Organization',
      name: orgData?.name || 'Dusun Bedalo',
      logo: {
        '@type': 'ImageObject',
        url: orgData?.logo || `${siteConfig.site.url}/assets/images/logo.png`,
      },
    },
    ...data,
  };
} else if (type === 'Product') {
  schema = {
    ...schema,
    '@type': 'Product',
    name: data.name as string,
    description: data.description as string,
    image: data.image as string,
    offers: {
      '@type': 'Offer',
      price: data.price as string,
      priceCurrency: 'IDR',
      availability: 'https://schema.org/InStock',
    },
    ...data,
  };
} else if (type === 'Place') {
  schema = {
    ...schema,
    '@type': 'TouristAttraction',
    name: data.name as string,
    description: data.description as string,
    image: data.image as string,
    address: {
      '@type': 'PostalAddress',
      addressLocality: 'Saptosari',
      addressRegion: 'Gunungkidul',
      addressCountry: 'ID',
    },
    ...data,
  };
}
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
